<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Audio Explorer</title>

<style>
  body {
    margin: 0;
    background: #020402;
    color: #66ff99;
    font-family: monospace;
    overflow: hidden;
  }

  .crt {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background:
      repeating-linear-gradient(
        to bottom,
        rgba(0,255,120,0.05) 0px,
        rgba(0,255,120,0.02) 1px,
        rgba(0,0,0,0.05) 2px
      );
    mix-blend-mode: screen;
  }

  #galaxy {
    position: absolute;
    inset: 0;
    transform-origin: center center;
    transition: transform 1s ease;
  }

  .star {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #66ff99;
    box-shadow: 0 0 8px #66ff99;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
  }

  .star:hover {
    box-shadow: 0 0 14px #99ffcc;
    transform: scale(1.3);
  }

  .star.playing {
    background: #99ffcc;
    box-shadow: 0 0 16px #99ffcc;
    animation: pulse 2s ease-in-out infinite;
  }

  .star.error {
    background: #ff6666;
    box-shadow: 0 0 10px #ff6666;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .tooltip {
    position: absolute;
    background: rgba(0, 20, 10, 0.95);
    border: 1px solid #66ff99;
    padding: 8px 10px;
    font-size: 12px;
    max-width: 260px;
    line-height: 1.4;
    display: none;
    z-index: 10;
    pointer-events: none;
  }

  #controls {
    position: fixed;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 20, 10, 0.9);
    border: 1px solid #66ff99;
    padding: 8px 14px;
    font-size: 12px;
    min-width: 300px;
    text-align: center;
  }

  #player {
    margin-bottom: 6px;
  }

  #progress-container {
    width: 100%;
    height: 4px;
    background: rgba(102, 255, 153, 0.2);
    margin: 6px 0;
    cursor: pointer;
    display: none;
  }

  #progress-bar {
    height: 100%;
    background: #66ff99;
    width: 0%;
  }

  #playback-controls {
    display: none;
    margin-top: 6px;
    font-size: 11px;
  }

  #playback-controls button {
    background: transparent;
    border: 1px solid #66ff99;
    color: #66ff99;
    padding: 3px 8px;
    margin: 0 3px;
    cursor: pointer;
    font-family: monospace;
    font-size: 11px;
  }

  #settings-toggle {
    position: fixed;
    bottom: 12px;
    right: 12px;
    background: rgba(0, 20, 10, 0.9);
    border: 1px solid #66ff99;
    color: #66ff99;
    padding: 6px 12px;
    font-size: 11px;
    cursor: pointer;
  }

  #settings-panel {
    position: fixed;
    bottom: 70px;
    right: 12px;
    background: rgba(0, 20, 10, 0.95);
    border: 1px solid #66ff99;
    padding: 12px;
    font-size: 11px;
    max-width: 280px;
    display: none;
  }

  #settings-panel label {
    display: block;
    margin: 6px 0;
  }

  /* Errata */

  #errata-toggle {
    position: fixed;
    bottom: 12px;
    left: 12px;
    background: rgba(0, 20, 10, 0.9);
    border: 1px solid #66ff99;
    color: #66ff99;
    padding: 6px 10px;
    font-size: 11px;
    cursor: pointer;
  }

  #errata-panel {
    position: fixed;
    bottom: 52px;
    left: 12px;
    background: rgba(0, 20, 10, 0.95);
    border: 1px solid #66ff99;
    padding: 10px 14px;
    font-size: 11px;
    max-width: 320px;
    line-height: 1.5;
    display: none;
  }

  #errata-panel strong {
    color: #99ffcc;
  }

  .error-message {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
  }

  .error-box {
    background: rgba(20, 0, 0, 0.95);
    border: 1px solid #ff6666;
    color: #ff6666;
    padding: 16px 20px;
    font-size: 12px;
    max-width: 400px;
  }
</style>
</head>

<body>

<div id="galaxy"></div>
<div class="crt"></div>

<div id="controls">
  <div id="player">No star selected</div>
  <div id="progress-container">
    <div id="progress-bar"></div>
  </div>
  <div id="playback-controls">
    <button id="play-pause">Pause</button>
    <button id="speed-toggle">1.0x</button>
    <span id="time-display">0:00 / 0:00</span>
  </div>
</div>

<button id="settings-toggle">⚙ Settings</button>

<div id="settings-panel">
  <label><input type="checkbox" id="show-controls" /> Show playback controls</label>
  <label><input type="checkbox" id="auto-play-next" /> Auto-play next track</label>
  <label><input type="checkbox" id="orbital-drift" /> Orbital drift (experimental)</label>
</div>

<button id="errata-toggle">Errata / Notes</button>

<div id="errata-panel">
  <strong>Errata:</strong><br>
  “Mexica” is pronounced <em>Meh-SHEE-ka</em>, not “Mex-i-ca”.  
  The letter <em>X</em> in Nahuatl represents the “sh” sound.
</div>

<div class="error-message" id="error-message">
  <div class="error-box">
    <div id="error-text"></div>
    <div style="margin-top:10px;text-align:right;">
      <button onclick="errorMessage.style.display='none'">Dismiss</button>
    </div>
  </div>
</div>

<audio id="audio" preload="metadata"></audio>

<script>
const tracks = [
  { file:"La_ingenieria_de_la_violencia_mexica.mp3", title:"La ingeniería de la violencia mexica", lang:"ES",
    abstract:"Violencia como tecnología institucional y sistema de regulación política." },
  { file:"The_Aztec_Architecture_of_Sustainable_Violence.mp3", title:"The Aztec Architecture of Sustainable Violence", lang:"EN",
    abstract:"Violence treated as a bounded architectural system." },
  { file:"Why_Chess_Is_Easier_Than_Laundry.mp3", title:"Why Chess Is Easier Than Laundry", lang:"EN",
    abstract:"Why formal systems feel easier than open-ended maintenance." },
  { file:"التكنولوجيا_لا_تلغي_الصعوبة_بل_تعيد_توزيعها.mp3", title:"Technology Redistributes Difficulty", lang:"AR",
    abstract:"التكنولوجيا تعيد توزيع الصعوبة بدل إلغائها." },
  { file:"Nuestra_vara_de_la_dificultad_está_chueca.mp3", title:"Nuestra vara de la dificultad está chueca", lang:"ES",
    abstract:"Crítica a métricas modernas de dificultad." },
  { file:"Abstraction_ls_Just_Energy_Minimization.mp3", title:"Abstraction Is Just Energy Minimization", lang:"EN",
    abstract:"Abstraction as thermodynamic compression." },
  { file:"The_Myth_of_Dual_Cognition.mp3", title:"The Myth of Dual Cognition", lang:"EN",
    abstract:"Cognition as resolution, not dual systems." },
  { file:"La_ilusion_del_pensamiento_dual.mp3", title:"La ilusión del pensamiento dual", lang:"ES",
    abstract:"Lo automático y lo deliberado como un solo proceso." }
];

const galaxy = document.getElementById("galaxy");
const audio = document.getElementById("audio");
const player = document.getElementById("player");
const progressBar = document.getElementById("progress-bar");
const progressContainer = document.getElementById("progress-container");
const playbackControls = document.getElementById("playback-controls");
const playPauseBtn = document.getElementById("play-pause");
const speedToggle = document.getElementById("speed-toggle");
const timeDisplay = document.getElementById("time-display");
const errorMessage = document.getElementById("error-message");
const errorText = document.getElementById("error-text");

const errataToggle = document.getElementById("errata-toggle");
const errataPanel = document.getElementById("errata-panel");

errataToggle.onclick = () => {
  errataPanel.style.display = errataPanel.style.display === "block" ? "none" : "block";
};

let currentStar = null;
let currentIndex = -1;
const stars = [];

const centerX = innerWidth / 2;
const centerY = innerHeight / 2;

function clearStarStates() {
  stars.forEach(s => s.classList.remove("playing","error"));
}

function showError(msg) {
  errorText.textContent = msg;
  errorMessage.style.display = "flex";
}

tracks.forEach((track, i) => {
  const star = document.createElement("div");
  star.className = "star";
  stars.push(star);

  const angle = Math.random() * Math.PI * 2;
  const radius = 140 + Math.random() * 260;

  const x = centerX + Math.cos(angle) * radius;
  const y = centerY + Math.sin(angle) * radius;

  star.style.left = x + "px";
  star.style.top = y + "px";
  star.dataset.x = x;
  star.dataset.y = y;
  star.dataset.angle = angle;
  star.dataset.radius = radius;

  const tooltip = document.createElement("div");
  tooltip.className = "tooltip";
  tooltip.innerHTML = `<strong>${track.title}</strong> [${track.lang}]<br>${track.abstract}`;
  document.body.appendChild(tooltip);

  star.onmouseenter = e => {
    tooltip.style.display = "block";
    tooltip.style.left = e.clientX + 12 + "px";
    tooltip.style.top = e.clientY + 12 + "px";
  };

  star.onmousemove = e => {
    tooltip.style.left = e.clientX + 12 + "px";
    tooltip.style.top = e.clientY + 12 + "px";
  };

  star.onmouseleave = () => tooltip.style.display = "none";

  star.onclick = () => playTrack(i, star);

  galaxy.appendChild(star);
});

function playTrack(i, star) {
  clearStarStates();

  const x = parseFloat(star.dataset.x);
  const y = parseFloat(star.dataset.y);

  galaxy.style.transform = `translate(${centerX - x}px, ${centerY - y}px)`;

  audio.src = tracks[i].file;
  audio.play().catch(e => showError(e.message));

  star.classList.add("playing");
  currentStar = star;
  currentIndex = i;

  player.textContent = `${tracks[i].title} (${tracks[i].lang})`;
}

audio.onerror = () => {
  if (currentStar) currentStar.classList.add("error");
  showError("Failed to load audio file.");
};

audio.ontimeupdate = () => {
  if (!audio.duration) return;
  progressBar.style.width = (audio.currentTime / audio.duration * 100) + "%";

  const f = s => `${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,"0")}`;
  timeDisplay.textContent = `${f(audio.currentTime)} / ${f(audio.duration)}`;
};

playPauseBtn.onclick = () => audio.paused ? audio.play() : audio.pause();

const speeds = [1,1.25,1.5,1.75,2];
let speedIndex = 0;
speedToggle.onclick = () => {
  speedIndex = (speedIndex + 1) % speeds.length;
  audio.playbackRate = speeds[speedIndex];
  speedToggle.textContent = speeds[speedIndex] + "x";
};
</script>

</body>
</html>
